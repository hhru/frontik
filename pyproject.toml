[build-system]
requires = ['poetry-core>=1.5.1']
build-backend = 'poetry.core.masonry.api'

[tool.poetry]
name = 'frontik'
version = '7.3.2'
description = 'Frontik is an asyncronous Tornado-based application server'
authors = ['architecture <arch-team@hh.ru>']
repository = 'https://github.com/hhru/frontik'
homepage = 'https://github.com/hhru/frontik'
readme = 'README.md'

[tool.poetry.scripts]
frontik = 'frontik.server:main'

[tool.poetry.dependencies]
python = '3.11.*'
aiohttp = '3.8.3'
jinja2 = '3.1.2'
lxml = '4.9.2'
pydantic = '^2.3.0'
tornado = '6.3.2'
http-client = {git = 'https://github.com/hhru/balancing-http-client.git', tag = '2.1.4'}
python-consul2-hh = {git = 'https://github.com/hhru/python-consul2', tag = 'v0.2.9'}
opentelemetry-sdk = '1.17.0'
opentelemetry-api = '1.17.0'
opentelemetry-exporter-otlp-proto-grpc = '1.17.0'
opentelemetry-instrumentation-tornado = '0.38b0'
opentelemetry-instrumentation-aiohttp-client = '0.38b0'

[tool.poetry.group.test.dependencies]
pytest = '>=7.2.0'
pytest-asyncio = '0.21.1'
pycodestyle = '>=2.5.0'
requests = '>=2.0'
types-requests = '2.31.0.8'
tox = '4.6.4'
lxml-asserts = '0.1.2'
tornado-httpclient-mock = '0.2.3'
sentry-sdk = '1.26.0'
aiokafka = '0.8.1'
aioresponses = '0.7.4'
mypy = '1.5.1'
black = '23.9.1'
ruff = '0.0.291'

[tool.pytest.ini_options]
addopts = '''
  --tb native
  --asyncio-mode=auto
  -p no:warnings
'''

[tool.black]
line-length = 120
skip-string-normalization = true

[tool.mypy]
ignore_missing_imports = true
disallow_untyped_calls = true
disallow_incomplete_defs = true
check_untyped_defs = true
strict = false
exclude = [
    '.*/api/2.*',
]


[tool.ruff]
line-length = 120
target-version = 'py311'
select = [
    'F',
    'E',
    'W',
    'I',
    'N',
    'UP',
    'ASYNC',
    'B',
    'COM',
    'C4',
    'T10',
    'EM',
    'FA',
    'ISC',
    'ICN',
    'G',
    'T20',
    'PT',
    'SLOT',
    'SIM',
    'TID',
    'TCH',
    'INT',
    'TD',
    'FIX',
    'ERA',
    'FLY',
    'PERF',
    'FURB',
    'LOG',
]
preview = true
ignore = [
    'N818', 'EM101', 'EM102', 'SIM300',
    'B028', 'B904',
    'B008', 'B009', 'B010',
]

[tool.ruff.per-file-ignores]
'tests/**/*.py' = [
    'S101', # asserts allowed in tests...
    'ARG', # Unused function args -> fixtures nevertheless are functionally relevant...
    'FBT', # Don't care about booleans as positional arguments in tests, e.g. via @pytest.mark.parametrize()
    'PLR2004', # Magic value used in comparison, ...
    'S311', # Standard pseudo-random generators are not suitable for cryptographic purposes
    'PT009', 'PT027', # while using unittest
]

[tool.ruff.format]
quote-style = 'single'
