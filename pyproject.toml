[build-system]
requires = ['poetry-core>=1.5.1']
build-backend = 'poetry.core.masonry.api'

[tool.poetry]
name = 'frontik'
version = '7.1.3'
description = 'Frontik is an asyncronous Tornado-based application server'
authors = ['architecture <arch-team@hh.ru>']
repository = 'https://github.com/hhru/frontik'
homepage = 'https://github.com/hhru/frontik'
readme = 'README.md'

[tool.poetry.scripts]
frontik = 'frontik.server:main'

[tool.poetry.dependencies]
python = '3.11.*'
aiohttp = '3.8.3'
jinja2 = '3.1.2'
lxml = '4.9.2'
pydantic = '>=1.10.5,<2'
tornado = '6.3.2'
http-client = {git = 'https://github.com/hhru/balancing-http-client.git', tag = '2.1.3'}
python-consul2-hh = {git = 'https://github.com/hhru/python-consul2', tag = 'v0.2.9'}
opentelemetry-sdk = '1.17.0'
opentelemetry-api = '1.17.0'
opentelemetry-exporter-otlp-proto-grpc = '1.17.0'
opentelemetry-instrumentation-tornado = '0.38b0'
opentelemetry-instrumentation-aiohttp-client = '0.38b0'

[tool.poetry.group.test.dependencies]
pytest = '>=7.2.0'
pytest-asyncio = '0.21.1'
pycodestyle = '>=2.5.0'
requests = '>=2.0'
tox = '4.6.4'
lxml-asserts = '0.1.2'
tornado-httpclient-mock = '0.2.3'
sentry-sdk = '1.26.0'
aiokafka = '0.8.1'
aioresponses = '0.7.4'
mypy = '1.5.1'
black = '23.9.1'
ruff = '0.0.291'

[tool.pytest.ini_options]
addopts = '''
  --tb native
  --asyncio-mode=auto
  -p no:warnings
'''

[tool.black]
line-length = 120
skip-string-normalization = true

[tool.mypy]
ignore_missing_imports = true
disallow_untyped_calls = true
disallow_incomplete_defs = true
check_untyped_defs = true
strict = false
exclude = [
    '.*/api/2.*',
]


[tool.ruff]
line-length = 120
target-version = 'py311'
select = [
    'F',
    'E',
    'W',
#    'C90',  # прикольная хрень но мы не готовы к такому
    'I',
    'N',
    'UP',
#    'ANN',  # ебать, неужели это мупи заменяет, с этой хуйни ошибок столько же сколько со всего вместе взятого
    'ASYNC',
#    'S',  # говорит lxml нельзя, так что хз как его врубать
#    'BLE',  # не готов все голые except Exception рефакторить
#    'FBT',  # это рефакторить тоже писос полный
    'B',
#    'A',  # в остальных репах я бы врубил но тут чето хз как жить с этим либо noqa
    'COM',
    'C4',
#    'DTZ',  # хз вот
    'T10',
    'EM',
    'FA',
    'ISC',
    'ICN',
    'G',
    'T20',
    'PT',
#    'Q',  # ну у нас не в почете дабл квоты
    'RSE',
#    'RET',  # не, думаю это нахер, иногда читаемость пиздаче
#    'SLF',  # в сервисах надо но тут нет
    'SLOT',
    'SIM',
    'TID',
    'TCH',
    'INT',
#    'ARG',  # ваще охуенная тема, но тут большинство неправильных
#    'PTH',  # нахер, через ос по старинке нормально
    'TD',
    'FIX',
#    'ERA',  # врубим но позднее когда дев закончится
#    'PGH',  # хорошая тема, но чето не варик тут врубать
#    'PL',  # хорошая тема, но чето не варик тут врубать
#    'TRY',  # хорошая тема, но чето не варик тут врубать
    'FLY',
    'PERF',
    'FURB',
    'LOG',
#    'RUF',  # не, какие-то у него ебаныте правила
]
preview = true
ignore = ['N818', 'B028', 'B904']

[tool.ruff.per-file-ignores]
'tests/**/*.py' = [
    'S101', # asserts allowed in tests...
    'ARG', # Unused function args -> fixtures nevertheless are functionally relevant...
    'FBT', # Don't care about booleans as positional arguments in tests, e.g. via @pytest.mark.parametrize()
    'PLR2004', # Magic value used in comparison, ...
    'S311', # Standard pseudo-random generators are not suitable for cryptographic purposes
    'PT009', 'PT027', # пока на пайтест все не переписал
]